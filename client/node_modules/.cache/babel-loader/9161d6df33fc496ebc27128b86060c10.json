{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/PC/temp/couplove/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/PC/temp/couplove/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/PC/temp/couplove/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState,useRef}from'react';import axios from'axios';import TextField from'@material-ui/core/TextField';import{makeStyles}from'@material-ui/core/styles';import'date-fns';import DateFnsUtils from'@date-io/date-fns';import{MuiPickersUtilsProvider,KeyboardDatePicker}from'@material-ui/pickers';import InputLabel from'@material-ui/core/InputLabel';import FormControl from'@material-ui/core/FormControl';import Select from'@material-ui/core/Select';import MenuItem from'@material-ui/core/MenuItem';import'../css/profileInfo.css';import ReactAvatar from'@material-ui/core/Avatar';import Button from'@material-ui/core/Button';import AddAPhotoIcon from'@material-ui/icons/AddAPhoto';import IconButton from'@material-ui/core/IconButton';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var genders=[{value:'male',label:'male'},{value:'female',label:'female'}];var useStyles=makeStyles(function(theme){return{formControl:{marginTop:20,minWidth:\"90%\"}};});export default function UserProfileForm(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),nickname=_useState2[0],setNickname=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),bio=_useState4[0],setBio=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),croppedUrl=_useState6[0],setCroppedUrl=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),uploaded=_useState8[0],setUploaded=_useState8[1];var _useState9=useState(new Date()),_useState10=_slicedToArray(_useState9,2),dob=_useState10[0],setDob=_useState10[1];var _useState11=useState('male'),_useState12=_slicedToArray(_useState11,2),gender=_useState12[0],setGender=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),newProfile=_useState14[0],setNewProfile=_useState14[1];var _useState15=useState(),_useState16=_slicedToArray(_useState15,2),partner=_useState16[0],setPartner=_useState16[1];var _useState17=useState(),_useState18=_slicedToArray(_useState17,2),dateOfRelationship=_useState18[0],setDateOfRelationship=_useState18[1];var formRef=useRef();var classes=useStyles();useEffect(function(){var ac=new AbortController();axios.get('/auth/isLoggedIn').then(function(res){return res.data;}).catch(function(err){return console.log(err);}).then(function(res){if(res.isLoggedIn===false){window.open('/login','_self');}else if(res.user.nickname){setNickname(res.user.nickname);setDob(res.user.dateOfBirth);setGender(res.user.gender);setBio(res.user.bio);if(res.user.partner!==null){setPartner(res.user.partner);if(res.user.dateOfRelationship){setDateOfRelationship(res.user.dateOfRelationship);}}}});return function cancel(){ac.abort();};},[]);useEffect(function(){var ac=new AbortController();axios({method:'get',url:'/gridFs/checkExists',headers:{'Content-Type':'multipart/form-data'}}).then(function(res){return res.data;}).catch(function(err){return console.log(err);}).then(function(res){if(res===true){document.getElementById(\"overlay\").style.visibility=\"hidden\";}});return function cancel(){ac.abort();};},[]);if(uploaded){var reader=new FileReader();reader.onload=function(event){if(event.target.result===null){return;}document.getElementById(\"avatarImg\").setAttribute(\"src\",event.target.result);};reader.readAsDataURL(croppedUrl);}function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}function _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var formData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(uploaded){axios.get('/gridFs/deleteImg');}event.preventDefault();formData=new FormData(formRef.current);partner&&formData.append('partner',partner);_context.next=6;return axios({method:'post',url:'/user/info',data:formData,headers:{'Content-Type':'multipart/form-data'}});case 6:window.location.href=\"/\";case 7:case\"end\":return _context.stop();}}},_callee);}));return _handleSubmit.apply(this,arguments);}function toggleNewFile(event){var file=event.target.files[0];if(file===undefined){return;}else{document.getElementById(\"overlay\").style.visibility=\"hidden\";setCroppedUrl(file);setUploaded(true);}}function uploadFile(){document.getElementById(\"file\").click();}return/*#__PURE__*/_jsx(\"div\",{className:\"infoForm\",id:\"infoForm\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,ref:formRef,children:[/*#__PURE__*/_jsxs(\"div\",{id:\"avatar\",children:[/*#__PURE__*/_jsx(ReactAvatar,{id:\"overlay\"}),/*#__PURE__*/_jsx(\"img\",{src:uploaded?\"\":\"/gridFs/getProfile\",id:\"avatarImg\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"fileIpt\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"file\",id:\"file\",onChange:toggleNewFile}),/*#__PURE__*/_jsx(IconButton,{id:\"uploadBtn\",onClick:uploadFile,children:/*#__PURE__*/_jsx(AddAPhotoIcon,{})})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"infoDiv\",children:[/*#__PURE__*/_jsx(TextField,{id:\"nickname\",className:\"inputFields\",label:\"Nickname\",variant:\"outlined\",name:\"nickname\",value:nickname,onChange:function onChange(e){setNickname(e.target.value);}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",className:classes.formControl,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"demo-simple-select-outlined-label\",children:\"Gender\"}),/*#__PURE__*/_jsx(Select,{labelId:\"demo-simple-select-outlined-label\",id:\"demo-simple-select-outlined\",value:gender,onChange:function onChange(e){setGender(e.target.value);},label:\"Gender\",name:\"gender\",children:genders.map(function(option){return/*#__PURE__*/_jsx(MenuItem,{value:option.value,children:option.label},option.value);})})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(MuiPickersUtilsProvider,{utils:DateFnsUtils,style:{marginLeft:\"10px\"},children:/*#__PURE__*/_jsx(KeyboardDatePicker,{margin:\"normal\",id:\"dateOfBirth\",label:\"Date of birth (mm/dd/yyyy)\",name:\"dateOfBirth\",format:\"MM/dd/yyyy\",value:dob,onChange:function onChange(date){setDob(date);},KeyboardButtonProps:{'aria-label':'change date'}})}),dateOfRelationship&&/*#__PURE__*/_jsx(MuiPickersUtilsProvider,{utils:DateFnsUtils,children:/*#__PURE__*/_jsx(KeyboardDatePicker,{margin:\"normal\",id:\"dateOfRelation\",label:\"Date of relationship\",name:\"dateOfRelationship\",format:\"MM/dd/yyyy\",value:dateOfRelationship,onChange:function onChange(date){setDateOfRelationship(date);},KeyboardButtonProps:{'aria-label':'change date'}})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(TextField,{id:\"bio\",label:\"Bio\",variant:\"outlined\",name:\"bio\",className:\"inputFields\",value:bio,onChange:function onChange(e){setBio(e.target.value);}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{type:\"submit\",id:\"submitInfo\",children:\"submit\"})]})]})});}","map":{"version":3,"sources":["C:/Users/PC/temp/couplove/client/src/components/UserProfileForm.js"],"names":["useEffect","useState","useRef","axios","TextField","makeStyles","DateFnsUtils","MuiPickersUtilsProvider","KeyboardDatePicker","InputLabel","FormControl","Select","MenuItem","ReactAvatar","Button","AddAPhotoIcon","IconButton","genders","value","label","useStyles","theme","formControl","marginTop","minWidth","UserProfileForm","nickname","setNickname","bio","setBio","croppedUrl","setCroppedUrl","uploaded","setUploaded","Date","dob","setDob","gender","setGender","newProfile","setNewProfile","partner","setPartner","dateOfRelationship","setDateOfRelationship","formRef","classes","ac","AbortController","get","then","res","data","catch","err","console","log","isLoggedIn","window","open","user","dateOfBirth","cancel","abort","method","url","headers","document","getElementById","style","visibility","reader","FileReader","onload","event","target","result","setAttribute","readAsDataURL","handleSubmit","preventDefault","formData","FormData","current","append","location","href","toggleNewFile","file","files","undefined","uploadFile","click","e","map","option","marginLeft","date"],"mappings":"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","sourcesContent":["import {useEffect, useState, useRef} from 'react';\r\nimport axios from 'axios';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport 'date-fns';\r\nimport DateFnsUtils from '@date-io/date-fns';\r\nimport {\r\n  MuiPickersUtilsProvider,\r\n  KeyboardDatePicker,\r\n} from '@material-ui/pickers';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport Select from '@material-ui/core/Select';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport '../css/profileInfo.css';\r\nimport ReactAvatar from '@material-ui/core/Avatar';\r\nimport Button from '@material-ui/core/Button';\r\nimport AddAPhotoIcon from '@material-ui/icons/AddAPhoto';\r\nimport IconButton from '@material-ui/core/IconButton';\r\n\r\nconst genders = [\r\n    {\r\n      value: 'male',\r\n      label: 'male',\r\n    },\r\n    {\r\n      value: 'female',\r\n      label: 'female',\r\n    },\r\n  ];\r\n\r\n  const useStyles = makeStyles((theme) => ({\r\n    formControl: {\r\n      marginTop:20,\r\n      minWidth: \"90%\",\r\n    },\r\n  }));\r\nexport default function UserProfileForm()\r\n{\r\n    const [nickname,setNickname] = useState(\"\");\r\n    const [bio,setBio] = useState(\"\");\r\n    const [croppedUrl, setCroppedUrl] = useState();\r\n    const [uploaded,setUploaded] = useState(false);\r\n    const [dob,setDob] = useState(new Date());\r\n    const [gender,setGender] = useState('male');\r\n    const [newProfile,setNewProfile]=useState(false);\r\n    const [partner,setPartner] = useState();\r\n    const [dateOfRelationship,setDateOfRelationship] = useState();\r\n    const formRef = useRef();\r\n    const classes = useStyles();\r\n\r\n    useEffect(() => {\r\n        const ac = new AbortController();\r\n        axios.get('/auth/isLoggedIn')\r\n        .then(res =>res.data)\r\n        .catch(err => console.log(err))\r\n        .then(res => {\r\n          if (res.isLoggedIn === false) {\r\n            window.open('/login', '_self');\r\n          } \r\n          else if(res.user.nickname)\r\n          {\r\n            setNickname(res.user.nickname);\r\n            setDob(res.user.dateOfBirth);\r\n            setGender(res.user.gender);\r\n            setBio(res.user.bio);\r\n            if(res.user.partner!==null)\r\n            {\r\n            setPartner(res.user.partner);\r\n            if(res.user.dateOfRelationship)\r\n            {\r\n                setDateOfRelationship(res.user.dateOfRelationship);\r\n            }\r\n            }\r\n          }\r\n        })\r\n        return function cancel() {\r\n          ac.abort()\r\n        }\r\n      },[]);\r\n      useEffect(() => {\r\n        const ac = new AbortController();\r\n      axios({\r\n        method:'get',\r\n        url:'/gridFs/checkExists',\r\n        headers: {'Content-Type': 'multipart/form-data'}\r\n      })\r\n      .then(res=>res.data)\r\n      .catch(err=>console.log(err))\r\n      .then(res=>{\r\n        if(res===true)\r\n        {\r\n           document.getElementById(\"overlay\").style.visibility=\"hidden\";\r\n        }\r\n      })\r\n      return function cancel() {\r\n        ac.abort()\r\n      }\r\n    },[]);\r\n      if(uploaded)\r\n      {\r\n        const reader = new FileReader();\r\n        reader.onload = function(event){\r\n          if(event.target.result===null)\r\n          {\r\n            return;\r\n          }\r\n          document.getElementById(\"avatarImg\").setAttribute(\"src\",event.target.result);\r\n        }\r\n        reader.readAsDataURL(croppedUrl);\r\n       \r\n      }\r\n      async function handleSubmit(event) {\r\n        if(uploaded){axios.get('/gridFs/deleteImg');}\r\n        event.preventDefault();\r\n        \r\n        const formData = new FormData(formRef.current); \r\n        partner&&formData.append('partner',partner);\r\n         await  axios({\r\n            method:'post',\r\n            url:'/user/info',\r\n            data:formData,\r\n            headers: {'Content-Type': 'multipart/form-data'}\r\n          })\r\n          window.location.href = \"/\";\r\n      }\r\n\r\n      function toggleNewFile(event)\r\n      {\r\n        const file = event.target.files[0];\r\n         if(file===undefined)\r\n        {\r\n          return;\r\n        }\r\n        else\r\n        {\r\n         document.getElementById(\"overlay\").style.visibility=\"hidden\";\r\n         setCroppedUrl(file);\r\n         setUploaded(true);\r\n        }\r\n      }\r\n      \r\n      function uploadFile()\r\n      {\r\n         document.getElementById(\"file\").click();\r\n      }\r\n\r\n    return <div className=\"infoForm\" id=\"infoForm\">\r\n        \r\n    <form onSubmit={handleSubmit} ref={formRef}>\r\n      <div id=\"avatar\">\r\n       <ReactAvatar\r\n        id=\"overlay\"\r\n      />\r\n       <img src={uploaded?\"\":\"/gridFs/getProfile\"} id=\"avatarImg\"/>\r\n      </div>\r\n      <div className=\"fileIpt\">\r\n          <input type=\"file\" name=\"file\" id=\"file\" onChange={toggleNewFile}/>\r\n          <IconButton\r\n          id=\"uploadBtn\"\r\n          onClick={uploadFile}\r\n          >\r\n            <AddAPhotoIcon/>\r\n          </IconButton>\r\n      </div>\r\n          <br/>\r\n          <div className=\"infoDiv\">\r\n            <TextField\r\n            id=\"nickname\"\r\n            className=\"inputFields\"\r\n            label=\"Nickname\"\r\n            variant=\"outlined\"\r\n            name=\"nickname\"\r\n            value={nickname}\r\n            onChange={(e) => {setNickname(e.target.value)}}/>\r\n            <br/>\r\n            <FormControl variant=\"outlined\" className={classes.formControl}>\r\n            <InputLabel id=\"demo-simple-select-outlined-label\">Gender</InputLabel>\r\n            <Select\r\n              labelId=\"demo-simple-select-outlined-label\"\r\n              id=\"demo-simple-select-outlined\"\r\n              value={gender}\r\n              onChange={(e) => {setGender(e.target.value)}}\r\n              label=\"Gender\"\r\n              name=\"gender\"\r\n            >\r\n              {genders.map((option) => (\r\n                <MenuItem key={option.value} value={option.value}>\r\n                  {option.label}\r\n                </MenuItem>\r\n              ))}\r\n            </Select>\r\n          </FormControl> \r\n          <br />\r\n          <MuiPickersUtilsProvider utils={DateFnsUtils} style={{marginLeft:\"10px\"}}>\r\n            <KeyboardDatePicker\r\n              margin=\"normal\"\r\n              id=\"dateOfBirth\"\r\n              label=\"Date of birth (mm/dd/yyyy)\"\r\n              name=\"dateOfBirth\"\r\n              format=\"MM/dd/yyyy\"\r\n              value={dob}\r\n              onChange={(date) => {setDob(date)}}\r\n              KeyboardButtonProps={{\r\n                'aria-label': 'change date',\r\n              }}\r\n            />\r\n          </MuiPickersUtilsProvider>\r\n          {dateOfRelationship&&<MuiPickersUtilsProvider utils={DateFnsUtils}>\r\n            <KeyboardDatePicker\r\n              margin=\"normal\"\r\n              id=\"dateOfRelation\"\r\n              label=\"Date of relationship\"\r\n              name=\"dateOfRelationship\"\r\n              format=\"MM/dd/yyyy\"\r\n              value={dateOfRelationship}\r\n              onChange={(date) => {setDateOfRelationship(date)}}\r\n              KeyboardButtonProps={{\r\n                'aria-label': 'change date',\r\n              }}\r\n            />\r\n          </MuiPickersUtilsProvider>}\r\n          \r\n          <br/>    \r\n        \r\n     \r\n          <TextField\r\n            id=\"bio\"\r\n            label=\"Bio\"\r\n            variant=\"outlined\"\r\n            name=\"bio\"\r\n            className=\"inputFields\"\r\n            value={bio}\r\n            onChange={(e) => {setBio(e.target.value)}}/>\r\n            <br/>\r\n            \r\n          <Button type=\"submit\" id=\"submitInfo\">\r\n              submit\r\n          </Button>\r\n          </div>\r\n        </form>\r\n    </div>\r\n}"]},"metadata":{},"sourceType":"module"}