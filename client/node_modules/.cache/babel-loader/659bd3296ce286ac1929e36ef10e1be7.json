{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/PC/temp/couplove/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/PC/temp/couplove/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/PC/temp/couplove/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import ReactPlayer from'react-player';import'../css/videoPlayer.css';import IconButton from'@material-ui/core/IconButton';import PlayArrowIcon from'@material-ui/icons/PlayArrow';import PauseIcon from'@material-ui/icons/Pause';import Button from'@material-ui/core/Button';import ArrowLeftIcon from'@material-ui/icons/ArrowLeft';import VideoList from'./VideoList';import VideoUploadDiv from'./VideoUploadDiv';import ArrowRightIcon from'@material-ui/icons/ArrowRight';import VolumeMuteIcon from'@material-ui/icons/VolumeMute';import VolumeOffIcon from'@material-ui/icons/VolumeOff';import VolumeUpIcon from'@material-ui/icons/VolumeUp';import FullscreenIcon from'@material-ui/icons/Fullscreen';import FullscreenExitIcon from'@material-ui/icons/FullscreenExit';import HomeIcon from'@material-ui/icons/Home';import{FullScreen,useFullScreenHandle}from\"react-full-screen\";import io from'socket.io-client';import{useEffect,useRef,useState}from'react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var socket;export default function Cinema(){var ENDPOINT='localhost:5000';var handle=useFullScreenHandle();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),ready=_useState2[0],setReady=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),play=_useState4[0],setPlay=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),openUrl=_useState6[0],setOpenUrl=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),url=_useState8[0],setUrl=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),buffering=_useState10[0],setBuffering=_useState10[1];var _useState11=useState(0.5),_useState12=_slicedToArray(_useState11,2),volume=_useState12[0],setVolume=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isMuted=_useState14[0],setIsMuted=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),isLoud=_useState16[0],setIsLoud=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isFullScreen=_useState18[0],setIsFullScreen=_useState18[1];var videoRef=useRef();var urlRef=useRef(\"\");var readyToPlay=useRef(false);var initialRun=useRef(true);useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var ac;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:ac=new AbortController();socket=io(ENDPOINT);if(!initialRun.current){_context.next=6;break;}_context.next=5;return axios.get('/user/getRoomId').then(function(res){return res.data;}).catch(function(err){return console.log(err);}).then(function(res){socket.emit('join',{roomId:res.roomInfo._id});});case 5:initialRun.current=false;case 6:socket.on('changeState',function(state){setPlay(state);});socket.on('refreshPage',function(e){window.location.reload();});socket.on('update',function(time){if(urlRef.current===\"\"){urlRef.current=time.url;setReady(true);readyToPlay.current=true;setBuffering(false);return;}if(readyToPlay.current){if(time.time>videoRef.current.getCurrentTime()){if(videoRef.current.getCurrentTime()<time.time-1){videoRef.current.seekTo(String(time.time),'seconds');}}}});socket.on('updateProgress',function(pointed){videoRef.current.seekTo(pointed,'seconds');});socket.on('onlineUrl',function(data){if(data===\"\"){document.getElementById('url').value=\"\";return;}setReady(true);urlRef.current=data;setUrl(data);document.getElementById('url').value=\"\";});return _context.abrupt(\"return\",function cancel(){ac.abort();});case 12:case\"end\":return _context.stop();}}},_callee);})),[]);function displayProgress(){socket.emit('keepUpdate',{time:videoRef.current.getCurrentTime(),url:url});var point=document.getElementById('progress-point');var value=videoRef.current.getCurrentTime()/(videoRef.current.getDuration()/100);point.style.left=value+\"%\";}function handleProgressChange(event){var progressBarWidth=document.getElementById(\"progress-bar\");var choose=event.nativeEvent.offsetX;var pointed=choose/progressBarWidth.offsetWidth*videoRef.current.getDuration();socket.emit('changeProgress',pointed);setPlay(true);}function handleVideoState(){socket.emit('changeVideoState',play);}function submitUrl(event){event.preventDefault();var choosenUrl=document.getElementById('url').value;socket.emit('onlineUrl',choosenUrl);}function handleChooseMovie(_x){return _handleChooseMovie.apply(this,arguments);}function _handleChooseMovie(){_handleChooseMovie=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(filename){var choosenUrl;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setReady(true);choosenUrl=\"/videoFs/choose/\"+filename;socket.emit('onlineUrl',choosenUrl);case 3:case\"end\":return _context2.stop();}}},_callee2);}));return _handleChooseMovie.apply(this,arguments);}function handleUrlDiv(){var state=!openUrl;if(state){document.getElementById('submitUrl').style.marginLeft=0;}else{document.getElementById('submitUrl').style.marginLeft=\"-380px\";};setOpenUrl(!openUrl);}function handlePlayerVolume(){var value=document.getElementById(\"volume\").value;var actualVolume=parseFloat(value/100);if(actualVolume===0){setIsMuted(true);}else{setIsMuted(false);}if(value>50){setIsLoud(true);}else{setIsLoud(false);}setVolume(actualVolume);}function handleMute(){var state=!isMuted;if(state){setVolume(0);document.getElementById('volume').value=0;}else{setVolume(0.5);document.getElementById('volume').value=50;}setIsMuted(!isMuted);}function handleBigScreen(){var state=!isFullScreen;var controls=document.getElementById('controls');if(state){handle.enter();controls.style.bottom=\"-150px\";document.getElementById('progress-point').style.background=\"white\";document.getElementById('control-btn').style.color=\"white\";document.getElementById('control-vlm').style.color=\"white\";document.getElementById('fullscreen-btn').style.color=\"white\";}else{handle.exit();controls.style.bottom=\"-50px\";document.getElementById('progress-point').style.background=\"black\";document.getElementById('control-btn').style.color=\"black\";document.getElementById('control-vlm').style.color=\"black\";document.getElementById('fullscreen-btn').style.color=\"black\";}setIsFullScreen(!isFullScreen);}return/*#__PURE__*/_jsxs(\"div\",{className:\"cinema-div\",children:[/*#__PURE__*/_jsx(VideoList,{handleChooseMovie:handleChooseMovie,socket:socket}),/*#__PURE__*/_jsx(VideoUploadDiv,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"submit-url\",id:\"submitUrl\",children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitUrl,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"url\",placeholder:\"enter url\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"outlined\",id:\"submit-url-btn\",children:\" submit\"})]}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",id:\"handleUrlDiv\",onClick:handleUrlDiv,children:openUrl?/*#__PURE__*/_jsx(ArrowLeftIcon,{}):/*#__PURE__*/_jsx(ArrowRightIcon,{})})]}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"black\",href:\"/\",id:\"homeBtn\",children:/*#__PURE__*/_jsx(HomeIcon,{})}),/*#__PURE__*/_jsx(FullScreen,{handle:handle,children:/*#__PURE__*/_jsxs(\"div\",{className:\"video-player\",id:\"video-player\",children:[buffering&&ready&&/*#__PURE__*/_jsx(\"div\",{className:\"no-video\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"Loading....\"})}),ready?/*#__PURE__*/_jsx(ReactPlayer,{ref:videoRef,playing:play,height:\"100%\",width:\"100%\",url:urlRef.current,volume:volume,onProgress:displayProgress,onReady:function onReady(){return setBuffering(false);},onError:function onError(){return setReady(false);}}):/*#__PURE__*/_jsx(\"div\",{className:\"no-video\",children:/*#__PURE__*/_jsx(\"h2\",{children:\"No Video\"})}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\"},className:\"progress-bar-div\",id:\"controls\",children:[/*#__PURE__*/_jsx(IconButton,{onClick:handleVideoState,id:\"control-btn\",style:{color:\"black\"},children:play?/*#__PURE__*/_jsx(PauseIcon,{}):/*#__PURE__*/_jsx(PlayArrowIcon,{})}),/*#__PURE__*/_jsx(IconButton,{onClick:handleMute,id:\"control-vlm\",style:{color:\"black\"},children:isMuted?/*#__PURE__*/_jsx(VolumeOffIcon,{}):isLoud?/*#__PURE__*/_jsx(VolumeUpIcon,{}):/*#__PURE__*/_jsx(VolumeMuteIcon,{})}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:\"0\",max:\"100\",id:\"volume\",onChange:handlePlayerVolume}),/*#__PURE__*/_jsx(\"div\",{id:\"progress-bar\",className:\"progress-bar status\",onClick:ready?handleProgressChange:\"\",children:/*#__PURE__*/_jsx(\"div\",{id:\"progress-point\",className:\"progress-point\"})}),/*#__PURE__*/_jsx(IconButton,{onClick:handleBigScreen,id:\"fullscreen-btn\",style:{color:\"black\"},children:isFullScreen?/*#__PURE__*/_jsx(FullscreenExitIcon,{}):/*#__PURE__*/_jsx(FullscreenIcon,{})})]})]})})]});}","map":{"version":3,"sources":["C:/Users/PC/temp/couplove/client/src/components/Cinema.js"],"names":["ReactPlayer","IconButton","PlayArrowIcon","PauseIcon","Button","ArrowLeftIcon","VideoList","VideoUploadDiv","ArrowRightIcon","VolumeMuteIcon","VolumeOffIcon","VolumeUpIcon","FullscreenIcon","FullscreenExitIcon","HomeIcon","FullScreen","useFullScreenHandle","io","useEffect","useRef","useState","axios","socket","Cinema","ENDPOINT","handle","ready","setReady","play","setPlay","openUrl","setOpenUrl","url","setUrl","buffering","setBuffering","volume","setVolume","isMuted","setIsMuted","isLoud","setIsLoud","isFullScreen","setIsFullScreen","videoRef","urlRef","readyToPlay","initialRun","ac","AbortController","current","get","then","res","data","catch","err","console","log","emit","roomId","roomInfo","_id","on","state","e","window","location","reload","time","getCurrentTime","seekTo","String","pointed","document","getElementById","value","cancel","abort","displayProgress","point","getDuration","style","left","handleProgressChange","event","progressBarWidth","choose","nativeEvent","offsetX","offsetWidth","handleVideoState","submitUrl","preventDefault","choosenUrl","handleChooseMovie","filename","handleUrlDiv","marginLeft","handlePlayerVolume","actualVolume","parseFloat","handleMute","handleBigScreen","controls","enter","bottom","background","color","exit","display"],"mappings":"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","sourcesContent":["import ReactPlayer from 'react-player'\r\nimport '../css/videoPlayer.css';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport PlayArrowIcon from '@material-ui/icons/PlayArrow';\r\nimport PauseIcon from '@material-ui/icons/Pause';\r\nimport Button from '@material-ui/core/Button';\r\nimport ArrowLeftIcon from '@material-ui/icons/ArrowLeft';\r\nimport VideoList from './VideoList';\r\nimport VideoUploadDiv from './VideoUploadDiv';\r\nimport ArrowRightIcon from '@material-ui/icons/ArrowRight';\r\nimport VolumeMuteIcon from '@material-ui/icons/VolumeMute';\r\nimport VolumeOffIcon from '@material-ui/icons/VolumeOff'; \r\nimport VolumeUpIcon from '@material-ui/icons/VolumeUp';\r\nimport FullscreenIcon from '@material-ui/icons/Fullscreen';\r\nimport FullscreenExitIcon from '@material-ui/icons/FullscreenExit';\r\nimport HomeIcon from '@material-ui/icons/Home';\r\n\r\nimport { FullScreen, useFullScreenHandle } from \"react-full-screen\";\r\nimport io from 'socket.io-client';\r\nimport { useEffect, useRef, useState } from 'react';\r\nimport axios from 'axios';\r\n\r\nlet socket;\r\nexport default function Cinema()\r\n{\r\n  const ENDPOINT = 'localhost:5000';\r\n  const handle = useFullScreenHandle();\r\n  const [ready,setReady] = useState(false);\r\n  const [play,setPlay] =useState(false);\r\n  const [openUrl,setOpenUrl] = useState(false);\r\n  const [url,setUrl] = useState();\r\n  const [buffering,setBuffering] = useState(true);\r\n  const [volume,setVolume] = useState(0.5);\r\n  const [isMuted,setIsMuted] = useState(false);\r\n  const [isLoud,setIsLoud] = useState(false);\r\n  const [isFullScreen,setIsFullScreen] = useState(false);\r\n\r\n  const videoRef = useRef();\r\n  const urlRef = useRef(\"\");\r\n  const readyToPlay = useRef(false);\r\n  const initialRun = useRef(true);\r\n\r\n\r\n  useEffect(async()=>{\r\n      const ac = new AbortController();\r\n        socket = io(ENDPOINT);\r\n        if(initialRun.current)\r\n        {\r\n            await axios.get('/user/getRoomId')\r\n            .then(res=>res.data)\r\n            .catch(err=>console.log(err))\r\n            .then(res=>{\r\n                socket.emit('join',{roomId:res.roomInfo._id});\r\n            });\r\n            \r\n            initialRun.current = false;\r\n        }\r\n        socket.on('changeState',state=>{\r\n            setPlay(state);\r\n        });\r\n        socket.on('refreshPage',e=>{\r\n            window.location.reload();\r\n        })\r\n        socket.on('update',time=>{\r\n            if(urlRef.current===\"\")\r\n            {\r\n                urlRef.current = time.url;\r\n                setReady(true);\r\n                readyToPlay.current = true;\r\n                setBuffering(false);\r\n                return;\r\n            }\r\n            if(readyToPlay.current)\r\n            {\r\n                if(time.time>videoRef.current.getCurrentTime())\r\n                {\r\n                    if(videoRef.current.getCurrentTime()<(time.time)-1){\r\n                        videoRef.current.seekTo(String(time.time),'seconds');\r\n                    }\r\n                }\r\n            }\r\n        })\r\n\r\n        socket.on('updateProgress',pointed=>{\r\n            videoRef.current.seekTo(pointed,'seconds');\r\n        })\r\n\r\n        socket.on('onlineUrl',data=>{\r\n            if(data===\"\")\r\n            {\r\n                document.getElementById('url').value = \"\";\r\n                return;\r\n            }\r\n            setReady(true);\r\n            urlRef.current=data;\r\n            setUrl(data);\r\n            document.getElementById('url').value = \"\";\r\n        })\r\n\r\n      return function cancel(){\r\n          ac.abort();\r\n      }\r\n  },[])\r\n\r\n  function displayProgress()\r\n  {\r\n      socket.emit('keepUpdate',{time:videoRef.current.getCurrentTime(),url:url});\r\n      const point = document.getElementById('progress-point');\r\n      const value = videoRef.current.getCurrentTime()/(videoRef.current.getDuration()/100);\r\n      point.style.left = value+\"%\";\r\n  }\r\n   \r\n  function handleProgressChange(event)\r\n  {\r\n      const progressBarWidth = document.getElementById(\"progress-bar\");\r\n      const choose = event.nativeEvent.offsetX;\r\n      const pointed = (choose/progressBarWidth.offsetWidth)*videoRef.current.getDuration();     \r\n      socket.emit('changeProgress',pointed) \r\n      setPlay(true);\r\n  }\r\n  function handleVideoState()\r\n  {\r\n    socket.emit('changeVideoState',play);\r\n  }\r\n  \r\n  function submitUrl(event){\r\n    event.preventDefault();\r\n    const choosenUrl = document.getElementById('url').value;\r\n    socket.emit('onlineUrl',choosenUrl);\r\n  }\r\n\r\n  async function handleChooseMovie(filename)\r\n  {\r\n    \r\n    setReady(true);\r\n    const choosenUrl = \"/videoFs/choose/\"+filename;\r\n    socket.emit('onlineUrl',choosenUrl);\r\n  }\r\n  function handleUrlDiv()\r\n  {\r\n      let state = !openUrl;\r\n    if(state)\r\n    {\r\n        document.getElementById('submitUrl').style.marginLeft =0;\r\n    }\r\n    else\r\n    {\r\n        document.getElementById('submitUrl').style.marginLeft =\"-380px\";\r\n    };\r\n      setOpenUrl(!openUrl);  \r\n  }\r\n\r\n    function handlePlayerVolume()\r\n    {\r\n        const value=document.getElementById(\"volume\").value;\r\n        const actualVolume = parseFloat(value/100);\r\n        if(actualVolume===0)\r\n        {\r\n            setIsMuted(true);\r\n        }\r\n        else\r\n        {\r\n            setIsMuted(false);\r\n        }\r\n        if(value>50)\r\n        {\r\n            setIsLoud(true);\r\n        }\r\n        else\r\n        {\r\n            setIsLoud(false);\r\n        }\r\n        setVolume(actualVolume);\r\n    }\r\n    function handleMute()\r\n    {\r\n        let state = !isMuted;\r\n        if(state)\r\n        {\r\n            setVolume(0);\r\n            document.getElementById('volume').value =0;\r\n        }\r\n        else\r\n        {\r\n            setVolume(0.5);\r\n            document.getElementById('volume').value =50;\r\n        }\r\n        setIsMuted(!isMuted);\r\n    }\r\n\r\n    function handleBigScreen()\r\n    {\r\n        let state = !isFullScreen;\r\n        const controls = document.getElementById('controls');\r\n        if(state)\r\n        {\r\n            handle.enter();\r\n            controls.style.bottom=\"-150px\";\r\n            document.getElementById('progress-point').style.background=\"white\";\r\n            document.getElementById('control-btn').style.color=\"white\";\r\n            document.getElementById('control-vlm').style.color=\"white\";\r\n            document.getElementById('fullscreen-btn').style.color=\"white\";\r\n        }\r\n        else\r\n        {\r\n            handle.exit();\r\n            controls.style.bottom=\"-50px\";\r\n            document.getElementById('progress-point').style.background=\"black\";\r\n            document.getElementById('control-btn').style.color=\"black\";\r\n            document.getElementById('control-vlm').style.color=\"black\";\r\n            document.getElementById('fullscreen-btn').style.color=\"black\";\r\n        }\r\n        setIsFullScreen(!isFullScreen);\r\n    }\r\n    return <div className=\"cinema-div\">\r\n        <VideoList handleChooseMovie={handleChooseMovie} socket={socket}/>\r\n        \r\n        <VideoUploadDiv/>\r\n        <div className=\"submit-url\" id=\"submitUrl\">\r\n            <form onSubmit={submitUrl}>\r\n            <input type=\"text\" id=\"url\" placeholder=\"enter url\"/>\r\n            <Button\r\n                type=\"submit\"\r\n                variant=\"outlined\"\r\n                id=\"submit-url-btn\"\r\n            > submit</Button>\r\n            </form>\r\n            <IconButton size=\"small\" id=\"handleUrlDiv\" onClick={handleUrlDiv}>\r\n                {openUrl?<ArrowLeftIcon/>:<ArrowRightIcon/>}\r\n            </IconButton>\r\n        </div>\r\n        <Button variant=\"outlined\" color=\"black\" href=\"/\" id=\"homeBtn\">\r\n        <HomeIcon/>\r\n         </Button>\r\n        <FullScreen\r\n        handle={handle}\r\n        >\r\n        <div className=\"video-player\" id=\"video-player\">\r\n        {buffering&&ready&&<div className=\"no-video\">\r\n            <h1>Loading....</h1>\r\n        </div>}\r\n        {ready?\r\n        <ReactPlayer \r\n            ref={videoRef}\r\n            playing={play}\r\n            height=\"100%\"\r\n            width= \"100%\"\r\n            url={urlRef.current}\r\n            volume={volume}\r\n            onProgress={displayProgress}\r\n            onReady ={()=>setBuffering(false)}   \r\n            onError={()=>setReady(false)}\r\n        />:\r\n        <div className=\"no-video\">\r\n            <h2>No Video</h2>\r\n        </div>\r\n        }\r\n        {/* <video src=\"/videoFs/getVideos\" type=\"video/mp4\"/> */}\r\n            <div style={{display:\"flex\"}} className=\"progress-bar-div\" id=\"controls\">\r\n                <IconButton onClick={handleVideoState} id=\"control-btn\" style={{color:\"black\"}}>{play?<PauseIcon/>:<PlayArrowIcon/>}</IconButton>\r\n                <IconButton onClick={handleMute} id=\"control-vlm\" style={{color:\"black\"}}>{isMuted?<VolumeOffIcon/>:isLoud?<VolumeUpIcon/>:<VolumeMuteIcon/>}</IconButton>\r\n                <input type=\"range\" min=\"0\" max=\"100\" id=\"volume\" onChange={handlePlayerVolume}/>\r\n                <div id=\"progress-bar\" className=\"progress-bar status\" onClick={ready?handleProgressChange:\"\"}>\r\n                <div id=\"progress-point\" className=\"progress-point\"></div>\r\n                </div>\r\n                <IconButton onClick={handleBigScreen} id=\"fullscreen-btn\" style={{color:\"black\"}}>{isFullScreen?<FullscreenExitIcon/>:<FullscreenIcon/>}</IconButton>\r\n            </div>\r\n        </div>\r\n        </FullScreen>\r\n    </div>\r\n}"]},"metadata":{},"sourceType":"module"}