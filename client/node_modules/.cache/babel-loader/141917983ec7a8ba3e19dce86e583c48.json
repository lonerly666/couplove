{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/PC/temp/couplove/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/PC/temp/couplove/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"C:/Users/PC/temp/couplove/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:/Users/PC/temp/couplove/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import'../../css/createPost.css';import IconButton from'@material-ui/core/IconButton';import CloseIcon from'@material-ui/icons/Close';import NativeSelect from'@material-ui/core/NativeSelect';import ReactAvatar from'@material-ui/core/Avatar';import React,{useState,useCallback,useRef,useEffect}from'react';import Gallery from'react-photo-gallery';import DeleteIcon from'@material-ui/icons/Delete';import AddPhotoAlternateIcon from'@material-ui/icons/AddPhotoAlternate';import SelectedImage from'../SelectedImage';import Button from'@material-ui/core/Button';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function CreatePost(props){var setPost=props.setPost,handlePost=props.handlePost,userInfo=props.userInfo,setIsPosting=props.setIsPosting,setIsEditing=props.setIsEditing,isEditing=props.isEditing,postData=props.postData,setPostData=props.setPostData;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),text=_useState2[0],setText=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),uploadedFiles=_useState4[0],setUploadedFiles=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),feeling=_useState6[0],setFeeling=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),willBeDeletedFiles=_useState8[0],setWillBeDeletedFiles=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),deletedExistingFiles=_useState10[0],setDeletedExistingFiles=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,1),selectAll=_useState12[0];var formRef=useRef();var imageRenderer=useCallback(function(_ref){var index=_ref.index,left=_ref.left,top=_ref.top,key=_ref.key,photo=_ref.photo;return/*#__PURE__*/_jsx(SelectedImage,{selected:selectAll?true:false,margin:\"2px\",index:index,photo:photo,left:left,top:top,handleChooseNotToDeleteFile:handleChooseNotToDeleteFile,handleChooseToDeleteFile:handleChooseToDeleteFile},key);},[selectAll,handleChooseNotToDeleteFile,handleChooseToDeleteFile]);useEffect(function(){if(isEditing){setText(postData.post.text);setFeeling(postData.post.feeling);if(postData.post.fileId){setUploadedFiles(postData.post.fileId.map(function(id,index){// console.log(postData.url[index]);\nreturn{src:postData.url[index],width:1,height:1,fileId:id};}));}}},[]);function handleChooseToDeleteFile(index){setWillBeDeletedFiles(function(prevData){return[].concat(_toConsumableArray(prevData),[index]);});}function handleChooseNotToDeleteFile(index){setWillBeDeletedFiles(function(prevData){return prevData.filter(function(val){return val!==index;});});}function handleUploadFiles(event){var file=event.target.files[0];if(file){var re=/\\.(gif|jpe?g|tiff?|png|webp|bmp)$/i;if(re.test(file.name)){setUploadedFiles(function(prevData){return[].concat(_toConsumableArray(prevData),[{src:URL.createObjectURL(file),file:file,width:1,height:1}]);});}else{alert('only upload image files.');}}}function handleDeleteChosenFiles(){return _handleDeleteChosenFiles.apply(this,arguments);}function _handleDeleteChosenFiles(){_handleDeleteChosenFiles=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var tempDeletedFiles,tempUploadedFiles,i;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:tempDeletedFiles=_toConsumableArray(willBeDeletedFiles).sort();tempUploadedFiles=_toConsumableArray(uploadedFiles);i=tempDeletedFiles.length-1;case 3:if(!(i>=0)){_context.next=11;break;}if(!tempUploadedFiles[tempDeletedFiles[i]].fileId){_context.next=7;break;}_context.next=7;return setDeletedExistingFiles(function(prevData){return[].concat(_toConsumableArray(prevData),[tempUploadedFiles[tempDeletedFiles[i]].fileId]);});case 7:tempUploadedFiles.splice(tempDeletedFiles[i],1);case 8:i--;_context.next=3;break;case 11:setUploadedFiles(tempUploadedFiles);setWillBeDeletedFiles([]);case 13:case\"end\":return _context.stop();}}},_callee);}));return _handleDeleteChosenFiles.apply(this,arguments);}function togglePost(){return _togglePost.apply(this,arguments);}function _togglePost(){_togglePost=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var formdata,i,j,_formdata,_i2;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(text==='')){_context2.next=3;break;}alert(\"Please enter some text\");return _context2.abrupt(\"return\");case 3:formdata=new FormData(formRef.current);if(!isEditing){_context2.next=14;break;}formdata.set('postId',postData.post._id);formdata.set('text',text);formdata.set('feeling',feeling);for(i=0;i<deletedExistingFiles.length;i++){formdata.append('deletedFile[]',deletedExistingFiles[i]);}for(j=0;j<uploadedFiles.length;j++){if(uploadedFiles[j].file){formdata.append('fileInput[]',uploadedFiles[j].file);}else{formdata.append('fileInput[]',uploadedFiles[j].fileId);}}_context2.next=12;return axios({method:'post',url:'/post/editPost',data:formdata,headers:{'Content-Type':'multipart/form-data'}}).then(function(res){return res.data;}).catch(function(err){return console.log(err);}).then(function(res){if(res.result){setPost(function(prevData){var temp=[];for(var _i=0;_i<prevData.length;_i++){if(prevData[_i]._id===res.result.docs._id){temp.push(res.result.docs);}else{temp.push(prevData[_i]);}}return temp;});handlePost();}else{alert(\"Failed to edit post\");}}).catch(function(err){return console.log(err);});case 12:_context2.next=19;break;case 14:_formdata=new FormData(formRef.current);for(_i2=0;_i2<uploadedFiles.length;_i2++){_formdata.append('fileInput[]',uploadedFiles[_i2].file);}_context2.next=18;return axios({method:'post',url:'/post/createPost',data:_formdata}).then(function(res){return res.data;}).catch(function(err){return console.log(err);}).then(function(res){if(res){alert(\"Memory Created!\");setPost(function(prevData){return[res].concat(_toConsumableArray(prevData));});}else{alert(\"Opps something went wrong\");}}).catch(function(err){return console.log(err);});case 18:handlePost();case 19:case\"end\":return _context2.stop();}}},_callee2);}));return _togglePost.apply(this,arguments);}return/*#__PURE__*/_jsxs(\"div\",{className:\"create-div\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"create-title\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[isEditing?\"Edit\":\"Create\",\" Memory\"]}),/*#__PURE__*/_jsx(IconButton,{onClick:handlePost,id:\"create-close-btn\",children:/*#__PURE__*/_jsx(CloseIcon,{})})]}),/*#__PURE__*/_jsxs(\"form\",{ref:formRef,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"create-feeling-div\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"create-profile-pic\",children:/*#__PURE__*/_jsx(ReactAvatar,{src:\"/gridFs/getProfile\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"create-greeting\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"Hi, \",userInfo.nickname,\" how are you feeling today?\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"create-select\",children:/*#__PURE__*/_jsxs(NativeSelect,{value:feeling,onChange:function onChange(event){return setFeeling(event.target.value);},id:\"create-feeling\",name:\"feeling\",children:[/*#__PURE__*/_jsx(\"option\",{\"aria-label\":\"None\",value:\"\"}),/*#__PURE__*/_jsx(\"option\",{value:\"happy\",children:\"Happy \\uD83D\\uDE00 \"}),/*#__PURE__*/_jsx(\"option\",{value:\"sad\",children:\"Sad \\u2639\\uFE0F\"}),/*#__PURE__*/_jsx(\"option\",{value:\"surprise\",children:\"Surprised \\uD83D\\uDE2E\"}),/*#__PURE__*/_jsx(\"option\",{value:\"meh\",children:\"Meh \\uD83D\\uDE15\"}),/*#__PURE__*/_jsx(\"option\",{value:\"annoyed\",children:\"Annoyed \\uD83D\\uDE44\"}),/*#__PURE__*/_jsx(\"option\",{value:\"sleepy\",children:\"Sleepy \\uD83D\\uDE34\"}),/*#__PURE__*/_jsx(\"option\",{value:\"love\",children:\"Love \\uD83E\\uDD70\"}),/*#__PURE__*/_jsx(\"option\",{value:\"touched\",children:\"Touched \\uD83D\\uDE2D\"}),/*#__PURE__*/_jsx(\"option\",{value:\"shy\",children:\"Shy \\uD83D\\uDE0C\"}),/*#__PURE__*/_jsx(\"option\",{value:\"amazed\",children:\"Amazed \\uD83E\\uDD29\"})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"create-textarea\",children:/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"What's on your mind?\",rows:\"10\",value:text,onChange:function onChange(e){return setText(e.target.value);},name:\"text\",id:\"text\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"create-gallery-div\",children:/*#__PURE__*/_jsx(Gallery,{photos:uploadedFiles,renderImage:imageRenderer,id:\"create-gallery\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"create-btn-div\",children:[/*#__PURE__*/_jsx(IconButton,{id:\"create-btn\",onClick:function onClick(){return document.getElementById('create-photo').click();},children:/*#__PURE__*/_jsx(AddPhotoAlternateIcon,{})}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",hidden:true,id:\"create-photo\",onChange:handleUploadFiles}),uploadedFiles.length>0&&/*#__PURE__*/_jsx(IconButton,{id:\"create-btn\",onClick:handleDeleteChosenFiles,children:/*#__PURE__*/_jsx(DeleteIcon,{})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"create-post-div\",children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",id:\"create-post-btn\",onClick:togglePost,children:\"Post\"})})]})]});}","map":{"version":3,"sources":["C:/Users/PC/temp/couplove/client/src/components/MemoryBook/CreatePost.js"],"names":["IconButton","CloseIcon","NativeSelect","ReactAvatar","React","useState","useCallback","useRef","useEffect","Gallery","DeleteIcon","AddPhotoAlternateIcon","SelectedImage","Button","axios","CreatePost","props","setPost","handlePost","userInfo","setIsPosting","setIsEditing","isEditing","postData","setPostData","text","setText","uploadedFiles","setUploadedFiles","feeling","setFeeling","willBeDeletedFiles","setWillBeDeletedFiles","deletedExistingFiles","setDeletedExistingFiles","selectAll","formRef","imageRenderer","index","left","top","key","photo","handleChooseNotToDeleteFile","handleChooseToDeleteFile","post","fileId","map","id","src","url","width","height","prevData","filter","val","handleUploadFiles","event","file","target","files","re","test","name","URL","createObjectURL","alert","handleDeleteChosenFiles","tempDeletedFiles","sort","tempUploadedFiles","i","length","splice","togglePost","formdata","FormData","current","set","_id","append","j","method","data","headers","then","res","catch","err","console","log","result","temp","docs","push","nickname","value","e","document","getElementById","click"],"mappings":"imBAAA,MAAO,0BAAP,CAEA,MAAOA,CAAAA,UAAP,KAAuB,8BAAvB,CACA,MAAOC,CAAAA,SAAP,KAAsB,0BAAtB,CACA,MAAOC,CAAAA,YAAP,KAAyB,gCAAzB,CACA,MAAOC,CAAAA,WAAP,KAAwB,0BAAxB,CACA,MAAOC,CAAAA,KAAP,EAAgBC,QAAhB,CAAyBC,WAAzB,CAAsCC,MAAtC,CAA8CC,SAA9C,KAA+D,OAA/D,CACA,MAAOC,CAAAA,OAAP,KAAoB,qBAApB,CACA,MAAOC,CAAAA,UAAP,KAAuB,2BAAvB,CACA,MAAOC,CAAAA,qBAAP,KAAkC,sCAAlC,CACA,MAAOC,CAAAA,aAAP,KAA0B,kBAA1B,CACA,MAAOC,CAAAA,MAAP,KAAmB,0BAAnB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,C,wFAEA,cAAe,SAASC,CAAAA,UAAT,CAAoBC,KAApB,CACf,CACI,GAAMC,CAAAA,OAAN,CAA8FD,KAA9F,CAAMC,OAAN,CAAcC,UAAd,CAA8FF,KAA9F,CAAcE,UAAd,CAAyBC,QAAzB,CAA8FH,KAA9F,CAAyBG,QAAzB,CAAkCC,YAAlC,CAA8FJ,KAA9F,CAAkCI,YAAlC,CAA+CC,YAA/C,CAA8FL,KAA9F,CAA+CK,YAA/C,CAA4DC,SAA5D,CAA8FN,KAA9F,CAA4DM,SAA5D,CAAsEC,QAAtE,CAA8FP,KAA9F,CAAsEO,QAAtE,CAA+EC,WAA/E,CAA8FR,KAA9F,CAA+EQ,WAA/E,CAEA,cAAuBnB,QAAQ,CAAC,EAAD,CAA/B,wCAAOoB,IAAP,eAAYC,OAAZ,eACA,eAAyCrB,QAAQ,CAAC,EAAD,CAAjD,yCAAOsB,aAAP,eAAqBC,gBAArB,eACA,eAA6BvB,QAAQ,EAArC,yCAAOwB,OAAP,eAAeC,UAAf,eACA,eAAoDzB,QAAQ,CAAC,EAAD,CAA5D,yCAAO0B,kBAAP,eAA2BC,qBAA3B,eACA,eAAwD3B,QAAQ,CAAC,EAAD,CAAhE,0CAAO4B,oBAAP,gBAA6BC,uBAA7B,gBACA,gBAAoB7B,QAAQ,CAAC,KAAD,CAA5B,2CAAO8B,SAAP,gBAEA,GAAMC,CAAAA,OAAO,CAAG7B,MAAM,EAAtB,CAEA,GAAM8B,CAAAA,aAAa,CAAG/B,WAAW,CAC7B,kBAAGgC,CAAAA,KAAH,MAAGA,KAAH,CAAUC,IAAV,MAAUA,IAAV,CAAgBC,GAAhB,MAAgBA,GAAhB,CAAqBC,GAArB,MAAqBA,GAArB,CAA0BC,KAA1B,MAA0BA,KAA1B,oBACE,KAAC,aAAD,EACE,QAAQ,CAAEP,SAAS,CAAG,IAAH,CAAU,KAD/B,CAGE,MAAM,CAAE,KAHV,CAIE,KAAK,CAAEG,KAJT,CAKE,KAAK,CAAEI,KALT,CAME,IAAI,CAAEH,IANR,CAOE,GAAG,CAAEC,GAPP,CAQE,2BAA2B,CAAEG,2BAR/B,CASE,wBAAwB,CAAEC,wBAT5B,EAEOH,GAFP,CADF,EAD6B,CAc7B,CAACN,SAAD,CAAWQ,2BAAX,CAAuCC,wBAAvC,CAd6B,CAAjC,CAiBMpC,SAAS,CAAC,UAAI,CACZ,GAAGc,SAAH,CACA,CACEI,OAAO,CAACH,QAAQ,CAACsB,IAAT,CAAcpB,IAAf,CAAP,CACAK,UAAU,CAACP,QAAQ,CAACsB,IAAT,CAAchB,OAAf,CAAV,CACA,GAAGN,QAAQ,CAACsB,IAAT,CAAcC,MAAjB,CAAwB,CACxBlB,gBAAgB,CAACL,QAAQ,CAACsB,IAAT,CAAcC,MAAd,CAAqBC,GAArB,CAAyB,SAACC,EAAD,CAAIV,KAAJ,CAAY,CACpD;AACA,MAAO,CAACW,GAAG,CAAC1B,QAAQ,CAAC2B,GAAT,CAAaZ,KAAb,CAAL,CAAyBa,KAAK,CAAC,CAA/B,CAAiCC,MAAM,CAAC,CAAxC,CAA0CN,MAAM,CAACE,EAAjD,CAAP,CACD,CAHgB,CAAD,CAAhB,CAID,CACA,CACF,CAZQ,CAYP,EAZO,CAAT,CAcN,QAASJ,CAAAA,wBAAT,CAAkCN,KAAlC,CAAyC,CACrCN,qBAAqB,CAAC,SAAAqB,QAAQ,CAAI,CAChC,mCAAWA,QAAX,GAAqBf,KAArB,GACD,CAFoB,CAArB,CAGD,CAED,QAASK,CAAAA,2BAAT,CAAqCL,KAArC,CAA4C,CAC1CN,qBAAqB,CAAC,SAAAqB,QAAQ,CAAI,CAChC,MAAOA,CAAAA,QAAQ,CAACC,MAAT,CAAgB,SAAAC,GAAG,CAAI,CAC5B,MAAOA,CAAAA,GAAG,GAAKjB,KAAf,CACD,CAFM,CAAP,CAGD,CAJoB,CAArB,CAKD,CAEH,QAASkB,CAAAA,iBAAT,CAA2BC,KAA3B,CACA,CACI,GAAMC,CAAAA,IAAI,CAAGD,KAAK,CAACE,MAAN,CAAaC,KAAb,CAAmB,CAAnB,CAAb,CACA,GAAGF,IAAH,CACA,CACI,GAAMG,CAAAA,EAAE,CAAI,oCAAZ,CACA,GAAIA,EAAE,CAACC,IAAH,CAAQJ,IAAI,CAACK,IAAb,CAAJ,CAAwB,CACpBnC,gBAAgB,CAAC,SAAAyB,QAAQ,CAAI,CAC3B,mCAAWA,QAAX,GAAqB,CAACJ,GAAG,CAAEe,GAAG,CAACC,eAAJ,CAAoBP,IAApB,CAAN,CAAiCA,IAAI,CAAEA,IAAvC,CAA6CP,KAAK,CAAC,CAAnD,CAAqDC,MAAM,CAAC,CAA5D,CAArB,GACD,CAFe,CAAhB,CAGD,CAJH,IAIS,CACLc,KAAK,CAAC,0BAAD,CAAL,CACD,CACN,CAEJ,CAxEL,QA0EmBC,CAAAA,uBA1EnB,+KA0EI,4KACUC,gBADV,CAC6B,mBAAIrC,kBAAJ,EAAwBsC,IAAxB,EAD7B,CAEUC,iBAFV,oBAEkC3C,aAFlC,EAGa4C,CAHb,CAGiBH,gBAAgB,CAACI,MAAjB,CAA0B,CAH3C,aAG8CD,CAAC,EAAI,CAHnD,+BAIUD,iBAAiB,CAACF,gBAAgB,CAACG,CAAD,CAAjB,CAAjB,CAAuCzB,MAJjD,+CAKcZ,CAAAA,uBAAuB,CAAC,SAAAmB,QAAQ,CAAI,CACxC,mCAAWA,QAAX,GAAqBiB,iBAAiB,CAACF,gBAAgB,CAACG,CAAD,CAAjB,CAAjB,CAAuCzB,MAA5D,GACD,CAF4B,CALrC,QASMwB,iBAAiB,CAACG,MAAlB,CAAyBL,gBAAgB,CAACG,CAAD,CAAzC,CAA8C,CAA9C,EATN,OAGsDA,CAAC,EAHvD,+BAWI3C,gBAAgB,CAAC0C,iBAAD,CAAhB,CACAtC,qBAAqB,CAAC,EAAD,CAArB,CAZJ,uDA1EJ,kEAyFqB0C,CAAAA,UAzFrB,wIAyFM,4KAEKjD,IAAI,GAAG,EAFZ,2BAIIyC,KAAK,CAAC,wBAAD,CAAL,CAJJ,yCAOQS,QAPR,CAOmB,GAAIC,CAAAA,QAAJ,CAAaxC,OAAO,CAACyC,OAArB,CAPnB,KAQKvD,SARL,2BAUIqD,QAAQ,CAACG,GAAT,CAAa,QAAb,CAAsBvD,QAAQ,CAACsB,IAAT,CAAckC,GAApC,EACAJ,QAAQ,CAACG,GAAT,CAAa,MAAb,CAAoBrD,IAApB,EACAkD,QAAQ,CAACG,GAAT,CAAa,SAAb,CAAuBjD,OAAvB,EACA,IAAS0C,CAAT,CAAa,CAAb,CAAgBA,CAAC,CAAGtC,oBAAoB,CAACuC,MAAzC,CAAiDD,CAAC,EAAlD,CAAsD,CACpDI,QAAQ,CAACK,MAAT,CAAgB,eAAhB,CAAiC/C,oBAAoB,CAACsC,CAAD,CAArD,EACD,CACD,IAASU,CAAT,CAAa,CAAb,CAAgBA,CAAC,CAAGtD,aAAa,CAAC6C,MAAlC,CAA0CS,CAAC,EAA3C,CAA+C,CAC7C,GAAItD,aAAa,CAACsD,CAAD,CAAb,CAAiBvB,IAArB,CAA2B,CACzBiB,QAAQ,CAACK,MAAT,CAAgB,aAAhB,CAA+BrD,aAAa,CAACsD,CAAD,CAAb,CAAiBvB,IAAhD,EACD,CAFD,IAEO,CACLiB,QAAQ,CAACK,MAAT,CAAgB,aAAhB,CAA+BrD,aAAa,CAACsD,CAAD,CAAb,CAAiBnC,MAAhD,EACD,CACF,CAtBL,wBAuBUhC,CAAAA,KAAK,CAAC,CACVoE,MAAM,CAAC,MADG,CAEVhC,GAAG,CAAC,gBAFM,CAGViC,IAAI,CAACR,QAHK,CAIVS,OAAO,CAAC,CAAC,eAAgB,qBAAjB,CAJE,CAAD,CAAL,CAMLC,IANK,CAMA,SAAAC,GAAG,QAAEA,CAAAA,GAAG,CAACH,IAAN,EANH,EAOLI,KAPK,CAOC,SAAAC,GAAG,QAAEC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAF,EAPJ,EAQLH,IARK,CAQA,SAAAC,GAAG,CAAE,CACT,GAAGA,GAAG,CAACK,MAAP,CACA,CACE1E,OAAO,CAAC,SAAAoC,QAAQ,CAAE,CAChB,GAAMuC,CAAAA,IAAI,CAAC,EAAX,CACA,IAAI,GAAIrB,CAAAA,EAAC,CAAE,CAAX,CAAaA,EAAC,CAAClB,QAAQ,CAACmB,MAAxB,CAA+BD,EAAC,EAAhC,CACA,CACE,GAAGlB,QAAQ,CAACkB,EAAD,CAAR,CAAYQ,GAAZ,GAAkBO,GAAG,CAACK,MAAJ,CAAWE,IAAX,CAAgBd,GAArC,CACA,CACEa,IAAI,CAACE,IAAL,CAAUR,GAAG,CAACK,MAAJ,CAAWE,IAArB,EACD,CAHD,IAKA,CACED,IAAI,CAACE,IAAL,CAAUzC,QAAQ,CAACkB,EAAD,CAAlB,EACD,CACF,CACD,MAAOqB,CAAAA,IAAP,CACD,CAdM,CAAP,CAeA1E,UAAU,GACX,CAlBD,IAoBA,CACEgD,KAAK,CAAC,qBAAD,CAAL,CACD,CACF,CAhCK,EAiCLqB,KAjCK,CAiCC,SAAAC,GAAG,QAAEC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAF,EAjCJ,CAvBV,yCA4DYb,SA5DZ,CA4DuB,GAAIC,CAAAA,QAAJ,CAAaxC,OAAO,CAACyC,OAArB,CA5DvB,CA6DM,IAAQN,GAAR,CAAW,CAAX,CAAaA,GAAC,CAAC5C,aAAa,CAAC6C,MAA7B,CAAoCD,GAAC,EAArC,CACA,CACII,SAAQ,CAACK,MAAT,CAAgB,aAAhB,CAA8BrD,aAAa,CAAC4C,GAAD,CAAb,CAAiBb,IAA/C,EACH,CAhEP,wBAkEY5C,CAAAA,KAAK,CAAC,CACRoE,MAAM,CAAC,MADC,CAERhC,GAAG,CAAC,kBAFI,CAGRiC,IAAI,CAACR,SAHG,CAAD,CAAL,CAKLU,IALK,CAKA,SAAAC,GAAG,QAAEA,CAAAA,GAAG,CAACH,IAAN,EALH,EAMLI,KANK,CAMC,SAAAC,GAAG,QAAEC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAF,EANJ,EAOLH,IAPK,CAOA,SAAAC,GAAG,CAAE,CACT,GAAGA,GAAH,CACA,CACEpB,KAAK,CAAC,iBAAD,CAAL,CACAjD,OAAO,CAAC,SAAAoC,QAAQ,CAAE,CAChB,OAAOiC,GAAP,4BAAcjC,QAAd,GACD,CAFM,CAAP,CAGD,CAND,IAQA,CACEa,KAAK,CAAC,2BAAD,CAAL,CACD,CACF,CAnBK,EAoBLqB,KApBK,CAoBC,SAAAC,GAAG,QAAEC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAF,EApBJ,CAlEZ,SAuFMtE,UAAU,GAvFhB,yDAzFN,6CAmLI,mBAAM,aAAK,SAAS,CAAC,YAAf,wBACC,aAAK,SAAS,CAAC,cAAf,wBACI,sBAAKI,SAAS,CAAC,MAAD,CAAQ,QAAtB,aADJ,cAEI,KAAC,UAAD,EAAY,OAAO,CAAEJ,UAArB,CAAiC,EAAE,CAAC,kBAApC,uBAAuD,KAAC,SAAD,IAAvD,EAFJ,GADD,cAKE,cAAM,GAAG,CAAEkB,OAAX,wBACI,aAAK,SAAS,CAAC,oBAAf,wBACI,YAAK,SAAS,CAAC,oBAAf,uBACA,KAAC,WAAD,EACA,GAAG,CAAC,oBADJ,EADA,EADJ,cAMI,YAAK,SAAS,CAAC,iBAAf,uBACI,4BAAQjB,QAAQ,CAAC4E,QAAjB,iCADJ,EANJ,cASI,YAAK,SAAS,CAAC,eAAf,uBACI,MAAC,YAAD,EACA,KAAK,CAAElE,OADP,CAEA,QAAQ,CAAE,kBAAC4B,KAAD,QAAS3B,CAAAA,UAAU,CAAC2B,KAAK,CAACE,MAAN,CAAaqC,KAAd,CAAnB,EAFV,CAGA,EAAE,CAAC,gBAHH,CAIA,IAAI,CAAC,SAJL,wBAMA,eAAQ,aAAW,MAAnB,CAA0B,KAAK,CAAC,EAAhC,EANA,cAOA,eAAQ,KAAK,CAAC,OAAd,iCAPA,cAQA,eAAQ,KAAK,CAAC,KAAd,8BARA,cASA,eAAQ,KAAK,CAAC,UAAd,oCATA,cAUA,eAAQ,KAAK,CAAC,KAAd,8BAVA,cAWA,eAAQ,KAAK,CAAC,SAAd,kCAXA,cAYA,eAAQ,KAAK,CAAC,QAAd,iCAZA,cAaA,eAAQ,KAAK,CAAC,MAAd,+BAbA,cAcA,eAAQ,KAAK,CAAC,SAAd,kCAdA,cAeA,eAAQ,KAAK,CAAC,KAAd,8BAfA,cAgBA,eAAQ,KAAK,CAAC,QAAd,iCAhBA,GADJ,EATJ,GADJ,cA+BI,YAAK,SAAS,CAAC,iBAAf,uBACQ,iBAAU,WAAW,CAAC,sBAAtB,CAA6C,IAAI,CAAC,IAAlD,CAAuD,KAAK,CAAEvE,IAA9D,CAAoE,QAAQ,CAAE,kBAACwE,CAAD,QAAKvE,CAAAA,OAAO,CAACuE,CAAC,CAACtC,MAAF,CAASqC,KAAV,CAAZ,EAA9E,CAA4G,IAAI,CAAC,MAAjH,CAAwH,EAAE,CAAC,MAA3H,EADR,EA/BJ,cAkCI,YAAK,SAAS,CAAC,oBAAf,uBACA,KAAC,OAAD,EAAS,MAAM,CAAErE,aAAjB,CAAgC,WAAW,CAAEU,aAA7C,CAA4D,EAAE,CAAC,gBAA/D,EADA,EAlCJ,cAqCI,aAAK,SAAS,CAAC,gBAAf,wBACA,KAAC,UAAD,EAAY,EAAE,CAAC,YAAf,CAA4B,OAAO,CAAE,yBAAI6D,CAAAA,QAAQ,CAACC,cAAT,CAAwB,cAAxB,EAAwCC,KAAxC,EAAJ,EAArC,uBAA0F,KAAC,qBAAD,IAA1F,EADA,cAEA,cAAO,IAAI,CAAC,MAAZ,CAAmB,MAAM,KAAzB,CAA0B,EAAE,CAAC,cAA7B,CAA4C,QAAQ,CAAE5C,iBAAtD,EAFA,CAGC7B,aAAa,CAAC6C,MAAd,CAAqB,CAArB,eAAwB,KAAC,UAAD,EAAY,EAAE,CAAC,YAAf,CAA4B,OAAO,CAAEL,uBAArC,uBAA8D,KAAC,UAAD,IAA9D,EAHzB,GArCJ,cA0CI,YAAK,SAAS,CAAC,iBAAf,uBACA,KAAC,MAAD,EAAQ,OAAO,CAAC,WAAhB,CAA4B,EAAE,CAAC,iBAA/B,CAAiD,OAAO,CAAEO,UAA1D,kBADA,EA1CJ,GALF,GAAN,CAsDH","sourcesContent":["import '../../css/createPost.css';\r\n\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport NativeSelect from '@material-ui/core/NativeSelect';\r\nimport ReactAvatar from '@material-ui/core/Avatar';\r\nimport React, { useState,useCallback, useRef ,useEffect } from 'react';\r\nimport Gallery from 'react-photo-gallery';\r\nimport DeleteIcon from '@material-ui/icons/Delete';\r\nimport AddPhotoAlternateIcon from '@material-ui/icons/AddPhotoAlternate';\r\nimport SelectedImage from '../SelectedImage';\r\nimport Button from '@material-ui/core/Button';  \r\nimport axios from 'axios';\r\n\r\nexport default function CreatePost(props)\r\n{\r\n    const{setPost,handlePost,userInfo,setIsPosting,setIsEditing,isEditing,postData,setPostData} = props;\r\n\r\n    const [text,setText] = useState('');\r\n    const [uploadedFiles,setUploadedFiles] = useState([]);\r\n    const [feeling,setFeeling] = useState();\r\n    const [willBeDeletedFiles, setWillBeDeletedFiles] = useState([]);\r\n    const [deletedExistingFiles, setDeletedExistingFiles] = useState([]);\r\n    const [selectAll] = useState(false);\r\n\r\n    const formRef = useRef();\r\n\r\n    const imageRenderer = useCallback(\r\n        ({ index, left, top, key, photo }) => (\r\n          <SelectedImage\r\n            selected={selectAll ? true : false}\r\n            key={key}\r\n            margin={\"2px\"}\r\n            index={index}\r\n            photo={photo}\r\n            left={left}\r\n            top={top}\r\n            handleChooseNotToDeleteFile={handleChooseNotToDeleteFile}\r\n            handleChooseToDeleteFile={handleChooseToDeleteFile}\r\n          />\r\n        ),\r\n        [selectAll,handleChooseNotToDeleteFile,handleChooseToDeleteFile]\r\n      );\r\n\r\n          useEffect(()=>{\r\n            if(isEditing)\r\n            {\r\n              setText(postData.post.text);\r\n              setFeeling(postData.post.feeling);\r\n              if(postData.post.fileId){\r\n              setUploadedFiles(postData.post.fileId.map((id,index)=>{\r\n                // console.log(postData.url[index]);\r\n                return {src:postData.url[index],width:1,height:1,fileId:id};\r\n              }))\r\n            }\r\n            }\r\n          },[])\r\n\r\n    function handleChooseToDeleteFile(index) {\r\n        setWillBeDeletedFiles(prevData => {\r\n          return [...prevData, index];\r\n        })\r\n      }\r\n  \r\n      function handleChooseNotToDeleteFile(index) {\r\n        setWillBeDeletedFiles(prevData => {\r\n          return prevData.filter(val => {\r\n            return val !== index;\r\n          })\r\n        })\r\n      }\r\n\r\n    function handleUploadFiles(event)\r\n    {\r\n        const file = event.target.files[0];\r\n        if(file)\r\n        {\r\n            const re =  /\\.(gif|jpe?g|tiff?|png|webp|bmp)$/i;\r\n            if (re.test(file.name)) {\r\n                setUploadedFiles(prevData => {\r\n                  return [...prevData, {src: URL.createObjectURL(file), file: file, width:1,height:1}];\r\n                })\r\n              } else {\r\n                alert('only upload image files.')\r\n              }\r\n        }\r\n\r\n    }\r\n\r\n    async function handleDeleteChosenFiles() {\r\n        const tempDeletedFiles = [...willBeDeletedFiles].sort();\r\n        const tempUploadedFiles = [...uploadedFiles];\r\n        for (var i = tempDeletedFiles.length - 1; i >= 0; i--) {\r\n          if (tempUploadedFiles[tempDeletedFiles[i]].fileId) {\r\n            await setDeletedExistingFiles(prevData => {\r\n              return [...prevData, tempUploadedFiles[tempDeletedFiles[i]].fileId];\r\n            })\r\n          }\r\n          tempUploadedFiles.splice(tempDeletedFiles[i], 1);\r\n        }\r\n        setUploadedFiles(tempUploadedFiles);\r\n        setWillBeDeletedFiles([]);\r\n      }\r\n\r\n      async function togglePost()\r\n      {\r\n        if(text==='')\r\n        {\r\n          alert(\"Please enter some text\");\r\n          return;\r\n        }\r\n        const formdata = new FormData(formRef.current);\r\n        if(isEditing)\r\n        { \r\n          formdata.set('postId',postData.post._id);\r\n          formdata.set('text',text);\r\n          formdata.set('feeling',feeling);\r\n          for (var i = 0; i < deletedExistingFiles.length; i++) {\r\n            formdata.append('deletedFile[]', deletedExistingFiles[i]);\r\n          }\r\n          for (var j = 0; j < uploadedFiles.length; j++) {\r\n            if (uploadedFiles[j].file) {\r\n              formdata.append('fileInput[]', uploadedFiles[j].file);\r\n            } else {\r\n              formdata.append('fileInput[]', uploadedFiles[j].fileId);\r\n            }\r\n          }\r\n          await axios({\r\n            method:'post',\r\n            url:'/post/editPost',\r\n            data:formdata,\r\n            headers:{'Content-Type': 'multipart/form-data'}\r\n          })\r\n          .then(res=>res.data)\r\n          .catch(err=>console.log(err))\r\n          .then(res=>{\r\n            if(res.result)\r\n            {\r\n              setPost(prevData=>{\r\n                const temp=[];\r\n                for(let i =0;i<prevData.length;i++)\r\n                {\r\n                  if(prevData[i]._id===res.result.docs._id)\r\n                  {\r\n                    temp.push(res.result.docs)\r\n                  }\r\n                  else\r\n                  {\r\n                    temp.push(prevData[i]);\r\n                  }\r\n                }\r\n                return temp;\r\n              })\r\n              handlePost();\r\n            }\r\n            else\r\n            {\r\n              alert(\"Failed to edit post\");\r\n            }\r\n          })\r\n          .catch(err=>console.log(err));\r\n        }\r\n        else\r\n        {\r\n            const formdata = new FormData(formRef.current);\r\n            for(let i =0;i<uploadedFiles.length;i++)\r\n            {\r\n                formdata.append('fileInput[]',uploadedFiles[i].file);\r\n            }\r\n            \r\n            await axios({\r\n                method:'post',\r\n                url:'/post/createPost',\r\n                data:formdata\r\n            })\r\n            .then(res=>res.data)\r\n            .catch(err=>console.log(err))\r\n            .then(res=>{\r\n              if(res)\r\n              {\r\n                alert(\"Memory Created!\");\r\n                setPost(prevData=>{\r\n                  return[res,...prevData];\r\n                })\r\n              }\r\n              else\r\n              {\r\n                alert(\"Opps something went wrong\")\r\n              }\r\n            })\r\n            .catch(err=>console.log(err))\r\n            handlePost();\r\n        }\r\n      }\r\n    return<div className=\"create-div\">\r\n           <div className=\"create-title\">\r\n               <h3>{isEditing?\"Edit\":\"Create\"} Memory</h3>\r\n               <IconButton onClick={handlePost} id=\"create-close-btn\"><CloseIcon/></IconButton>\r\n            </div>\r\n            <form ref={formRef} >\r\n                <div className=\"create-feeling-div\">\r\n                    <div className=\"create-profile-pic\">\r\n                    <ReactAvatar\r\n                    src=\"/gridFs/getProfile\"\r\n                    />\r\n                    </div>\r\n                    <div className=\"create-greeting\">\r\n                        <p>Hi, {userInfo.nickname} how are you feeling today?</p>\r\n                    </div>\r\n                    <div className=\"create-select\">\r\n                        <NativeSelect\r\n                        value={feeling}\r\n                        onChange={(event)=>setFeeling(event.target.value)}\r\n                        id=\"create-feeling\"\r\n                        name=\"feeling\"\r\n                        >\r\n                        <option aria-label=\"None\" value=\"\" />\r\n                        <option value=\"happy\">Happy 😀 </option>\r\n                        <option value=\"sad\">Sad ☹️</option>\r\n                        <option value=\"surprise\">Surprised 😮</option>\r\n                        <option value=\"meh\">Meh 😕</option>\r\n                        <option value=\"annoyed\">Annoyed 🙄</option>\r\n                        <option value=\"sleepy\">Sleepy 😴</option>\r\n                        <option value=\"love\">Love 🥰</option>\r\n                        <option value=\"touched\">Touched 😭</option>\r\n                        <option value=\"shy\">Shy 😌</option>\r\n                        <option value=\"amazed\">Amazed 🤩</option>\r\n                        </NativeSelect>\r\n                    </div>\r\n                </div>\r\n                <div className=\"create-textarea\">\r\n                        <textarea placeholder=\"What's on your mind?\" rows=\"10\" value={text} onChange={(e)=>setText(e.target.value)} name=\"text\" id=\"text\"/>\r\n                </div>\r\n                <div className=\"create-gallery-div\">\r\n                <Gallery photos={uploadedFiles} renderImage={imageRenderer} id=\"create-gallery\"/> \r\n                </div>\r\n                <div className=\"create-btn-div\">\r\n                <IconButton id=\"create-btn\" onClick={()=>document.getElementById('create-photo').click()}><AddPhotoAlternateIcon/></IconButton>\r\n                <input type=\"file\" hidden id=\"create-photo\" onChange={handleUploadFiles}/>\r\n                {uploadedFiles.length>0&&<IconButton id=\"create-btn\" onClick={handleDeleteChosenFiles}><DeleteIcon/></IconButton>}\r\n                </div>\r\n                <div className=\"create-post-div\">\r\n                <Button variant=\"contained\" id=\"create-post-btn\" onClick={togglePost}>\r\n                Post\r\n                </Button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n}"]},"metadata":{},"sourceType":"module"}