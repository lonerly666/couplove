{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\PC\\\\temp\\\\couplove\\\\client\\\\src\\\\components\\\\MemoryBook\\\\CreatePost.js\",\n    _s = $RefreshSig$();\n\nimport '../../css/createPost.css';\nimport IconButton from '@material-ui/core/IconButton';\nimport CloseIcon from '@material-ui/icons/Close';\nimport NativeSelect from '@material-ui/core/NativeSelect';\nimport ReactAvatar from '@material-ui/core/Avatar';\nimport React, { useState, useCallback, useRef, useEffect } from 'react';\nimport Gallery from 'react-photo-gallery';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport AddPhotoAlternateIcon from '@material-ui/icons/AddPhotoAlternate';\nimport SelectedImage from '../SelectedImage';\nimport Button from '@material-ui/core/Button';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function CreatePost(props) {\n  _s();\n\n  const {\n    setPost,\n    handlePost,\n    userInfo,\n    setIsPosting,\n    setIsEditing,\n    isEditing,\n    postData,\n    setPostData\n  } = props;\n  const [text, setText] = useState('');\n  const [uploadedFiles, setUploadedFiles] = useState([]);\n  const [feeling, setFeeling] = useState();\n  const [willBeDeletedFiles, setWillBeDeletedFiles] = useState([]);\n  const [deletedExistingFiles, setDeletedExistingFiles] = useState([]);\n  const [selectAll] = useState(false);\n  const formRef = useRef();\n  const imageRenderer = useCallback(({\n    index,\n    left,\n    top,\n    key,\n    photo\n  }) => /*#__PURE__*/_jsxDEV(SelectedImage, {\n    selected: selectAll ? true : false,\n    margin: \"2px\",\n    index: index,\n    photo: photo,\n    left: left,\n    top: top,\n    handleChooseNotToDeleteFile: handleChooseNotToDeleteFile,\n    handleChooseToDeleteFile: handleChooseToDeleteFile\n  }, key, false, {\n    fileName: _jsxFileName,\n    lineNumber: 30,\n    columnNumber: 11\n  }, this), [selectAll, handleChooseNotToDeleteFile, handleChooseToDeleteFile]);\n  useEffect(() => {\n    if (isEditing) {\n      setText(postData.post.text);\n      setFeeling(postData.post.feeling);\n\n      if (postData.post.fileId) {\n        setUploadedFiles(postData.post.fileId.map((id, index) => {\n          // console.log(postData.url[index]);\n          return {\n            src: postData.url[index],\n            width: 1,\n            height: 1,\n            fileId: id\n          };\n        }));\n      }\n    }\n  }, []);\n\n  function handleChooseToDeleteFile(index) {\n    setWillBeDeletedFiles(prevData => {\n      return [...prevData, index];\n    });\n  }\n\n  function handleChooseNotToDeleteFile(index) {\n    setWillBeDeletedFiles(prevData => {\n      return prevData.filter(val => {\n        return val !== index;\n      });\n    });\n  }\n\n  function handleUploadFiles(event) {\n    const file = event.target.files[0];\n    console.log(file);\n\n    if (file) {\n      const re = /\\.(gif|jpe?g|tiff?|png|webp|bmp)$/i;\n\n      if (re.test(file.name)) {\n        setUploadedFiles(prevData => {\n          return [...prevData, {\n            src: URL.createObjectURL(file),\n            file: file,\n            width: 1,\n            height: 1\n          }];\n        });\n      } else {\n        alert('only upload image files.');\n      }\n    }\n  }\n\n  async function handleDeleteChosenFiles() {\n    const tempDeletedFiles = [...willBeDeletedFiles].sort();\n    const tempUploadedFiles = [...uploadedFiles];\n\n    for (var i = tempDeletedFiles.length - 1; i >= 0; i--) {\n      if (tempUploadedFiles[tempDeletedFiles[i]].fileId) {\n        await setDeletedExistingFiles(prevData => {\n          return [...prevData, tempUploadedFiles[tempDeletedFiles[i]].fileId];\n        });\n      }\n\n      tempUploadedFiles.splice(tempDeletedFiles[i], 1);\n    }\n\n    setUploadedFiles(tempUploadedFiles);\n    setWillBeDeletedFiles([]);\n  }\n\n  async function togglePost() {\n    const formdata = new FormData(formRef.current);\n\n    if (isEditing) {\n      formdata.set('postId', postData.post._id);\n      formdata.set('text', text);\n      formdata.set('feeling', feeling);\n\n      for (var i = 0; i < deletedExistingFiles.length; i++) {\n        formdata.append('deletedFile[]', deletedExistingFiles[i]);\n      }\n\n      for (var j = 0; j < uploadedFiles.length; j++) {\n        if (uploadedFiles[j].file) {\n          console.log(uploadedFiles[j]);\n          formdata.append('fileInput[]', uploadedFiles[j].file);\n        } else {\n          formdata.append('fileInput[]', uploadedFiles[j].fileId);\n        }\n      }\n\n      axios({\n        method: 'post',\n        url: '/post/editPost',\n        data: formdata,\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      }).then(res => res.data).catch(err => console.log(err)).then(res => {\n        if (res.result) {\n          setPost(prevData => {\n            const temp = [];\n\n            for (let i = 0; i < prevData.length; i++) {\n              if (prevData[i]._id === res.result.docs._id) {\n                temp.push(res.result.docs);\n              } else {\n                temp.push(prevData[i]);\n              }\n            }\n\n            return temp;\n          });\n          handlePost();\n        } else {\n          alert(\"Failed to edit post\");\n        }\n      }).catch(err => console.log(err));\n    } else {\n      const formdata = new FormData(formRef.current);\n\n      for (let i = 0; i < uploadedFiles.length; i++) {\n        formdata.append('fileInput[]', uploadedFiles[i].file);\n      }\n\n      await axios({\n        method: 'post',\n        url: '/post/createPost',\n        data: formdata\n      }).then(res => res.data).catch(err => console.log(err)).then(res => {\n        if (res) {\n          alert(\"Memory Created!\");\n          setPost(prevData => {\n            return [res, ...prevData];\n          });\n        } else {\n          alert(\"Opps something went wrong\");\n        }\n      }).catch(err => console.log(err));\n      handlePost();\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"create-div\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"create-title\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: [isEditing ? \"Edit\" : \"Create\", \" Memory\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 16\n      }, this), /*#__PURE__*/_jsxDEV(IconButton, {\n        onClick: handlePost,\n        id: \"create-close-btn\",\n        children: /*#__PURE__*/_jsxDEV(CloseIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 71\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 16\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 12\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      ref: formRef,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"create-feeling-div\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"create-profile-pic\",\n          children: /*#__PURE__*/_jsxDEV(ReactAvatar, {\n            src: \"/gridFs/getProfile\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"create-greeting\",\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"Hi, \", userInfo.nickname, \" how are you feeling today?\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"create-select\",\n          children: /*#__PURE__*/_jsxDEV(NativeSelect, {\n            value: feeling,\n            onChange: event => setFeeling(event.target.value),\n            id: \"create-feeling\",\n            name: \"feeling\",\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              \"aria-label\": \"None\",\n              value: \"\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 214,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"happy\",\n              children: \"Happy \\uD83D\\uDE00 \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 215,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"sad\",\n              children: \"Sad \\u2639\\uFE0F\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 216,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"surprise\",\n              children: \"Surprised \\uD83D\\uDE2E\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 217,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"meh\",\n              children: \"Meh \\uD83D\\uDE15\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 218,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"annoyed\",\n              children: \"Annoyed \\uD83D\\uDE44\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 219,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"sleepy\",\n              children: \"Sleepy \\uD83D\\uDE34\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 220,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"love\",\n              children: \"Love \\uD83E\\uDD70\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 221,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"touched\",\n              children: \"Touched \\uD83D\\uDE2D\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 222,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"shy\",\n              children: \"Shy \\uD83D\\uDE0C\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 223,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"amazed\",\n              children: \"Amazed \\uD83E\\uDD29\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 224,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 208,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"create-textarea\",\n        children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n          placeholder: \"What's on your mind?\",\n          rows: \"10\",\n          value: text,\n          onChange: e => setText(e.target.value),\n          name: \"text\",\n          id: \"text\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"create-gallery-div\",\n        children: /*#__PURE__*/_jsxDEV(Gallery, {\n          photos: uploadedFiles,\n          renderImage: imageRenderer,\n          id: \"create-gallery\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"create-btn-div\",\n        children: [/*#__PURE__*/_jsxDEV(IconButton, {\n          id: \"create-btn\",\n          onClick: () => document.getElementById('create-photo').click(),\n          children: /*#__PURE__*/_jsxDEV(AddPhotoAlternateIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 107\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          hidden: true,\n          id: \"create-photo\",\n          onChange: handleUploadFiles\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 17\n        }, this), uploadedFiles.length > 0 && /*#__PURE__*/_jsxDEV(IconButton, {\n          id: \"create-btn\",\n          onClick: handleDeleteChosenFiles,\n          children: /*#__PURE__*/_jsxDEV(DeleteIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 237,\n            columnNumber: 104\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 42\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"create-post-div\",\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          id: \"create-post-btn\",\n          onClick: togglePost,\n          children: \"Post\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 192,\n    columnNumber: 11\n  }, this);\n}\n\n_s(CreatePost, \"0FuPk8bH5j6d4E8Wd6t5PZ+0Xjc=\");\n\n_c = CreatePost;\n\nvar _c;\n\n$RefreshReg$(_c, \"CreatePost\");","map":{"version":3,"sources":["C:/Users/PC/temp/couplove/client/src/components/MemoryBook/CreatePost.js"],"names":["IconButton","CloseIcon","NativeSelect","ReactAvatar","React","useState","useCallback","useRef","useEffect","Gallery","DeleteIcon","AddPhotoAlternateIcon","SelectedImage","Button","axios","CreatePost","props","setPost","handlePost","userInfo","setIsPosting","setIsEditing","isEditing","postData","setPostData","text","setText","uploadedFiles","setUploadedFiles","feeling","setFeeling","willBeDeletedFiles","setWillBeDeletedFiles","deletedExistingFiles","setDeletedExistingFiles","selectAll","formRef","imageRenderer","index","left","top","key","photo","handleChooseNotToDeleteFile","handleChooseToDeleteFile","post","fileId","map","id","src","url","width","height","prevData","filter","val","handleUploadFiles","event","file","target","files","console","log","re","test","name","URL","createObjectURL","alert","handleDeleteChosenFiles","tempDeletedFiles","sort","tempUploadedFiles","i","length","splice","togglePost","formdata","FormData","current","set","_id","append","j","method","data","headers","then","res","catch","err","result","temp","docs","push","nickname","value","e","document","getElementById","click"],"mappings":"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","sourcesContent":["import '../../css/createPost.css';\r\n\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport NativeSelect from '@material-ui/core/NativeSelect';\r\nimport ReactAvatar from '@material-ui/core/Avatar';\r\nimport React, { useState,useCallback, useRef ,useEffect } from 'react';\r\nimport Gallery from 'react-photo-gallery';\r\nimport DeleteIcon from '@material-ui/icons/Delete';\r\nimport AddPhotoAlternateIcon from '@material-ui/icons/AddPhotoAlternate';\r\nimport SelectedImage from '../SelectedImage';\r\nimport Button from '@material-ui/core/Button';  \r\nimport axios from 'axios';\r\n\r\nexport default function CreatePost(props)\r\n{\r\n    const{setPost,handlePost,userInfo,setIsPosting,setIsEditing,isEditing,postData,setPostData} = props;\r\n\r\n    const [text,setText] = useState('');\r\n    const [uploadedFiles,setUploadedFiles] = useState([]);\r\n    const [feeling,setFeeling] = useState();\r\n    const [willBeDeletedFiles, setWillBeDeletedFiles] = useState([]);\r\n    const [deletedExistingFiles, setDeletedExistingFiles] = useState([]);\r\n    const [selectAll] = useState(false);\r\n\r\n    const formRef = useRef();\r\n\r\n    const imageRenderer = useCallback(\r\n        ({ index, left, top, key, photo }) => (\r\n          <SelectedImage\r\n            selected={selectAll ? true : false}\r\n            key={key}\r\n            margin={\"2px\"}\r\n            index={index}\r\n            photo={photo}\r\n            left={left}\r\n            top={top}\r\n            handleChooseNotToDeleteFile={handleChooseNotToDeleteFile}\r\n            handleChooseToDeleteFile={handleChooseToDeleteFile}\r\n          />\r\n        ),\r\n        [selectAll,handleChooseNotToDeleteFile,handleChooseToDeleteFile]\r\n      );\r\n\r\n          useEffect(()=>{\r\n            if(isEditing)\r\n            {\r\n              setText(postData.post.text);\r\n              setFeeling(postData.post.feeling);\r\n              if(postData.post.fileId){\r\n              setUploadedFiles(postData.post.fileId.map((id,index)=>{\r\n                // console.log(postData.url[index]);\r\n                return {src:postData.url[index],width:1,height:1,fileId:id};\r\n              }))\r\n            }\r\n            }\r\n          },[])\r\n\r\n    function handleChooseToDeleteFile(index) {\r\n        setWillBeDeletedFiles(prevData => {\r\n          return [...prevData, index];\r\n        })\r\n      }\r\n  \r\n      function handleChooseNotToDeleteFile(index) {\r\n        setWillBeDeletedFiles(prevData => {\r\n          return prevData.filter(val => {\r\n            return val !== index;\r\n          })\r\n        })\r\n      }\r\n\r\n    function handleUploadFiles(event)\r\n    {\r\n        const file = event.target.files[0];\r\n        console.log(file);\r\n        if(file)\r\n        {\r\n            const re =  /\\.(gif|jpe?g|tiff?|png|webp|bmp)$/i;\r\n            if (re.test(file.name)) {\r\n                setUploadedFiles(prevData => {\r\n                  return [...prevData, {src: URL.createObjectURL(file), file: file, width:1,height:1}];\r\n                })\r\n              } else {\r\n                alert('only upload image files.')\r\n              }\r\n        }\r\n\r\n    }\r\n\r\n    async function handleDeleteChosenFiles() {\r\n        const tempDeletedFiles = [...willBeDeletedFiles].sort();\r\n        const tempUploadedFiles = [...uploadedFiles];\r\n        for (var i = tempDeletedFiles.length - 1; i >= 0; i--) {\r\n          if (tempUploadedFiles[tempDeletedFiles[i]].fileId) {\r\n            await setDeletedExistingFiles(prevData => {\r\n              return [...prevData, tempUploadedFiles[tempDeletedFiles[i]].fileId];\r\n            })\r\n          }\r\n          tempUploadedFiles.splice(tempDeletedFiles[i], 1);\r\n        }\r\n        setUploadedFiles(tempUploadedFiles);\r\n        setWillBeDeletedFiles([]);\r\n      }\r\n\r\n      async function togglePost()\r\n      {\r\n        const formdata = new FormData(formRef.current);\r\n        if(isEditing)\r\n        { \r\n          formdata.set('postId',postData.post._id);\r\n          formdata.set('text',text);\r\n          formdata.set('feeling',feeling);\r\n          for (var i = 0; i < deletedExistingFiles.length; i++) {\r\n            formdata.append('deletedFile[]', deletedExistingFiles[i]);\r\n          }\r\n          for (var j = 0; j < uploadedFiles.length; j++) {\r\n            if (uploadedFiles[j].file) {\r\n              console.log(uploadedFiles[j])\r\n              formdata.append('fileInput[]', uploadedFiles[j].file);\r\n            } else {\r\n              formdata.append('fileInput[]', uploadedFiles[j].fileId);\r\n            }\r\n          }\r\n          axios({\r\n            method:'post',\r\n            url:'/post/editPost',\r\n            data:formdata,\r\n            headers:{'Content-Type': 'multipart/form-data'}\r\n          })\r\n          .then(res=>res.data)\r\n          .catch(err=>console.log(err))\r\n          .then(res=>{\r\n            if(res.result)\r\n            {\r\n              setPost(prevData=>{\r\n                const temp=[];\r\n                for(let i =0;i<prevData.length;i++)\r\n                {\r\n                  if(prevData[i]._id===res.result.docs._id)\r\n                  {\r\n                    temp.push(res.result.docs)\r\n                  }\r\n                  else\r\n                  {\r\n                    temp.push(prevData[i]);\r\n                  }\r\n                }\r\n                return temp;\r\n              })\r\n              handlePost();\r\n            }\r\n            else\r\n            {\r\n              alert(\"Failed to edit post\");\r\n            }\r\n          })\r\n          .catch(err=>console.log(err));\r\n        }\r\n        else\r\n        {\r\n            const formdata = new FormData(formRef.current);\r\n            for(let i =0;i<uploadedFiles.length;i++)\r\n            {\r\n                formdata.append('fileInput[]',uploadedFiles[i].file);\r\n            }\r\n            \r\n            await axios({\r\n                method:'post',\r\n                url:'/post/createPost',\r\n                data:formdata\r\n            })\r\n            .then(res=>res.data)\r\n            .catch(err=>console.log(err))\r\n            .then(res=>{\r\n              if(res)\r\n              {\r\n                alert(\"Memory Created!\");\r\n                setPost(prevData=>{\r\n                  return[res,...prevData];\r\n                })\r\n              }\r\n              else\r\n              {\r\n                alert(\"Opps something went wrong\")\r\n              }\r\n            })\r\n            .catch(err=>console.log(err))\r\n            handlePost();\r\n        }\r\n      }\r\n    return<div className=\"create-div\">\r\n           <div className=\"create-title\">\r\n               <h3>{isEditing?\"Edit\":\"Create\"} Memory</h3>\r\n               <IconButton onClick={handlePost} id=\"create-close-btn\"><CloseIcon/></IconButton>\r\n            </div>\r\n            <form ref={formRef} >\r\n                <div className=\"create-feeling-div\">\r\n                    <div className=\"create-profile-pic\">\r\n                    <ReactAvatar\r\n                    src=\"/gridFs/getProfile\"\r\n                    />\r\n                    </div>\r\n                    <div className=\"create-greeting\">\r\n                        <p>Hi, {userInfo.nickname} how are you feeling today?</p>\r\n                    </div>\r\n                    <div className=\"create-select\">\r\n                        <NativeSelect\r\n                        value={feeling}\r\n                        onChange={(event)=>setFeeling(event.target.value)}\r\n                        id=\"create-feeling\"\r\n                        name=\"feeling\"\r\n                        >\r\n                        <option aria-label=\"None\" value=\"\" />\r\n                        <option value=\"happy\">Happy 😀 </option>\r\n                        <option value=\"sad\">Sad ☹️</option>\r\n                        <option value=\"surprise\">Surprised 😮</option>\r\n                        <option value=\"meh\">Meh 😕</option>\r\n                        <option value=\"annoyed\">Annoyed 🙄</option>\r\n                        <option value=\"sleepy\">Sleepy 😴</option>\r\n                        <option value=\"love\">Love 🥰</option>\r\n                        <option value=\"touched\">Touched 😭</option>\r\n                        <option value=\"shy\">Shy 😌</option>\r\n                        <option value=\"amazed\">Amazed 🤩</option>\r\n                        </NativeSelect>\r\n                    </div>\r\n                </div>\r\n                <div className=\"create-textarea\">\r\n                        <textarea placeholder=\"What's on your mind?\" rows=\"10\" value={text} onChange={(e)=>setText(e.target.value)} name=\"text\" id=\"text\"/>\r\n                </div>\r\n                <div className=\"create-gallery-div\">\r\n                <Gallery photos={uploadedFiles} renderImage={imageRenderer} id=\"create-gallery\"/> \r\n                </div>\r\n                <div className=\"create-btn-div\">\r\n                <IconButton id=\"create-btn\" onClick={()=>document.getElementById('create-photo').click()}><AddPhotoAlternateIcon/></IconButton>\r\n                <input type=\"file\" hidden id=\"create-photo\" onChange={handleUploadFiles}/>\r\n                {uploadedFiles.length>0&&<IconButton id=\"create-btn\" onClick={handleDeleteChosenFiles}><DeleteIcon/></IconButton>}\r\n                </div>\r\n                <div className=\"create-post-div\">\r\n                <Button variant=\"contained\" id=\"create-post-btn\" onClick={togglePost}>\r\n                Post\r\n                </Button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n}"]},"metadata":{},"sourceType":"module"}